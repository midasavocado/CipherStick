<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Food Jam ‚Äì The Tasty Card & Dice Game</title>

<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Fredoka+One&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#fff8f0; --ink:#2b2b2b; --accent:#ff9966; --accent-2:#ffcc66;
    --accent-ink:#7a2c00; --brand:#cc5500; --card:#ffffff; --soft:#fef0d9;
    --shadow:0 10px 24px rgba(0,0,0,.12); --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:'Comic Neue',cursive;}
  img{max-width:100%;height:auto;display:block}

  /* ---------- FULL-SCREEN HERO ---------- */
  header{
    position:relative;height:100svh;min-height:100vh;display:grid;place-items:center;
    overflow:hidden;isolation:isolate;color:#351800;padding:0; z-index:1;
  }
  header::before{
    content:"";position:absolute;inset:-10% -10%;
    background:
      radial-gradient(1400px 520px at 50% -10%, rgba(255,232,189,.85) 0%, rgba(255,232,189,0) 60%),
      linear-gradient(180deg, rgba(255,204,102,.85), rgba(255,204,102,.55));
    z-index:0;
  }
  header::after{
    content:"";position:absolute;inset:0;
    background:
      radial-gradient(1200px 600px at 50% 30%, rgba(0,0,0,0) 60%, rgba(0,0,0,.12) 100%),
      linear-gradient(180deg, rgba(0,0,0,.08), rgba(0,0,0,0) 35%, rgba(0,0,0,.10));
    z-index:1;pointer-events:none;
  }
  .hero-inner{position:relative;z-index:3;text-align:center;max-width:1100px;width:100%;padding:8vh 20px}
  .title-plate{
    display:inline-block;padding:10px 18px 16px;border-radius:22px;
    background:linear-gradient(180deg,rgba(255,255,255,.55),rgba(255,255,255,.35));
    backdrop-filter:saturate(1.2) blur(6px);box-shadow:0 12px 30px rgba(0,0,0,.15);margin-bottom:10px;
    transition:transform .12s ease, box-shadow .2s ease;
  }
  .title-plate:hover{transform:translateY(-2px); box-shadow:0 16px 28px rgba(0,0,0,.16)}
  .hero-title{font-family:'Fredoka One',cursive;font-size:clamp(54px,10.5vw,126px);line-height:.88;margin:0;color:#fff;text-shadow:0 2px 0 rgba(0,0,0,.15),0 10px 30px rgba(0,0,0,.25)}
  .hero-kicker{font-weight:900;font-size:clamp(16px,2.6vw,30px);color:#4e2200;margin:0 0 1rem}
  .verb-rotate{display:inline-block;min-width:7ch}
  .verb-rotate.swap{animation:verb-pop .6s ease both}
  @keyframes verb-pop{0%{transform:translateY(.6em) scale(.9);opacity:0}60%{transform:translateY(-.15em) scale(1.03);opacity:1}100%{transform:translateY(0) scale(1)}}
  .pills{display:flex;justify-content:center;gap:16px;flex-wrap:wrap;margin:10px auto 22px}
  .pill,.btn{
    background:#fff;border:none;border-radius:14px;padding:12px 16px;box-shadow:var(--shadow);
    font-weight:900;color:#7a2c00;font-family:'Fredoka One',cursive;
    transition:transform .12s ease, box-shadow .2s ease, filter .2s ease;
  }
  .pill:hover{transform:translateY(-2px); box-shadow:0 16px 28px rgba(0,0,0,.16)}
  .btn{padding:16px 20px;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .btn-accent{background:linear-gradient(180deg,#fff,#ffe1be)}
  .btn-accent:hover{filter:brightness(1.03); transform:translateY(-1px)}
  .cta-row{display:flex;justify-content:center;gap:12px;flex-wrap:wrap}

  .hero-collage{position:absolute;inset:0;z-index:2;pointer-events:auto;transition:transform .45s ease;}
  .mini-card{
    position:absolute;border-radius:12px;overflow:hidden;box-shadow:0 14px 22px rgba(0,0,0,.18);
    will-change:transform;cursor:pointer;
    transform:translate(var(--x,0px),var(--y,0px)) scale(var(--s,1));
    transition:transform .12s ease, box-shadow .2s ease, filter .2s ease;
  }
  .mini-card:hover{ --s:1.06; filter:saturate(1.05) }
  .mini-card img{display:block;width:100%;height:100%;object-fit:cover}

  /* small tweak panel (desktop only) */
  .size-tweak{
    margin-top:14px; display:inline-flex; align-items:center; gap:10px;
    background:#fff; border-radius:999px; padding:8px 12px; box-shadow:var(--shadow);
    font-weight:900; color:#7a2c00;
  }
  .size-tweak input[type="range"]{ width:160px }
  @media (max-width:700px){ .size-tweak{ display:none } }

  /* ---------- CONTENT ---------- */
  section{max-width:1100px;margin:0 auto;padding:64px 20px; position:relative; z-index:1;}
  .alt{background:linear-gradient(180deg,#fff8f0 0%, #fff2e2 100%)}
  h2{font-family:'Fredoka One',cursive;color:var(--brand);margin:0 0 18px; transition:transform .12s ease}
  h2:hover{transform:translateY(-2px)}
  .lead{font-size:1.05rem}

  .features{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
  .feature{
    border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);
    background:
      linear-gradient(#fff,#fff) padding-box,
      linear-gradient(135deg,#ffd29f,#ffb07f) border-box;
    border:2px solid transparent;
    transition:transform .12s ease, box-shadow .2s ease;
  }
  .feature:hover{transform:translateY(-3px); box-shadow:0 16px 28px rgba(0,0,0,.16)}

  .rule-chip{
    display:inline-block;background:#fff;padding:8px 12px;border-radius:999px;margin:6px 8px 0 0;box-shadow:var(--shadow);
    font-weight:700;color:#7a2c00; transition:transform .12s ease, box-shadow .2s ease;
  }
  .rule-chip:hover{transform:translateY(-2px); box-shadow:0 14px 24px rgba(0,0,0,.14)}

  .how{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-top:10px}
  .how .step{
    background:#fff;border-radius:16px;box-shadow:var(--shadow);padding:16px;font-weight:800;
    transition:transform .12s ease, box-shadow .2s ease;
  }
  .how .step:hover{transform:translateY(-3px); box-shadow:0 16px 28px rgba(0,0,0,.16)}

  .rules-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;margin-top:12px}
  .rules-grid img{
    border-radius:14px;box-shadow:var(--shadow);cursor:pointer;
    transition:transform .12s, box-shadow .12s
  }
  .rules-grid img:hover{transform:translateY(-2px) scale(1.02); box-shadow:0 16px 28px rgba(0,0,0,.16)}

  /* Card grid */
  .toolbar{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:16px}
  .filters{display:flex;gap:8px;flex-wrap:wrap}
  .chip{
    padding:8px 12px;border-radius:999px;border:2px solid #ffd29f;cursor:pointer;font-weight:800;background:#fff;
    transition:all .12s ease;
  }
  .chip.active{background:linear-gradient(180deg,#ffd29f,#ffc88e)}
  .chip:hover{transform:translateY(-1px)}
  .search{flex:1;min-width:200px}
  .search input{
    width:100%;padding:10px 12px;border-radius:10px;border:2px solid #ffd29f;background:#fff;font-weight:700;
    box-shadow:inset 0 2px 4px rgba(0,0,0,.04); transition:box-shadow .12s ease, transform .12s ease;
  }
  .search input:hover{transform:translateY(-1px)}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:16px}
  .tile{
    position:relative;background:var(--card);border-radius:16px;padding:12px;box-shadow:var(--shadow);
    transition:transform .12s, box-shadow .12s, filter .2s;
    background:
      linear-gradient(#fff,#fff) padding-box,
      radial-gradient(120% 120% at 0% 0%, #ffd29f 0%, #ffffff 70%) border-box;
    border:2px solid transparent;
  }
  .tile:hover{transform:translateY(-4px) scale(1.02); box-shadow:0 16px 28px rgba(0,0,0,.16)}
  .tile img{width:100%;border-radius:12px;display:block;aspect-ratio:3/4;object-fit:cover}
  .label{margin-top:8px;font-weight:800;color:#7a2c00;text-align:center}
  .type-tag{position:absolute;top:10px;left:10px;background:#fff;padding:4px 8px;border-radius:999px;font-size:.75rem;font-weight:900}

  /* ---------- Minimal modal viewer ---------- */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:30px;z-index:2000}
  .modal.open{display:flex}
  .viewer-min{
    position:relative;display:grid;place-items:center;width:min(92vw,560px);aspect-ratio:3/4;perspective:1200px;
    pointer-events:none;
  }
  .card3d{position:relative;width:100%;height:100%;transform-style:preserve-3d;border-radius:14px;overflow:hidden;z-index:1;pointer-events:auto}
  .card3d .face{position:absolute;inset:0;display:grid;place-items:center;backface-visibility:hidden;transition:transform .42s ease;background:#fff;border-radius:14px}
  .card3d .front{transform:rotateY(0deg)}
  .card3d .back{transform:rotateY(180deg)}
  .card3d.flipped .front{transform:rotateY(-180deg)}
  .card3d.flipped .back{transform:rotateY(0deg)}
  .card3d .face img{width:100%;height:100%;object-fit:contain}

  .edge{
    position:absolute;top:50%;transform:translateY(-50%);
    z-index:9999;width:64px;height:64px;display:grid;place-items:center;
    padding:0;border-radius:14px;font-size:32px;line-height:1;
    background:#fff;box-shadow:var(--shadow);color:#7a2c00;border:none;cursor:pointer;
    pointer-events:auto; transition:transform .12s ease, box-shadow .2s ease;
  }
  .edge:hover{transform:translateY(-2px); box-shadow:0 16px 28px rgba(0,0,0,.16)}
  .edge-left{left:8px}
  .edge-right{right:8px}

  .caption{position:absolute;bottom:-52px;left:50%;transform:translateX(-50%);background:#fff;color:#7a2c00;font-weight:900;padding:8px 12px;border-radius:999px;box-shadow:var(--shadow);white-space:nowrap;pointer-events:auto}
  .close{position:absolute;top:-10px;right:-10px;z-index:9999;pointer-events:auto}

  /* ---------- FULL-BLEED CONTACT CTA ---------- */
  .cta{max-width:none;margin:0;padding:0}
  .cta-full{
    background:linear-gradient(180deg,var(--accent),#ffb07f);
    color:#351800; width:100%;
  }
  .cta-full .inner{
    max-width:1100px;margin:0 auto;padding:72px 20px;
  }
  .cta-full h2{color:#fff;margin-top:0}
  #contact .card{
    background:#fff;border-radius:16px;box-shadow:var(--shadow);padding:18px;
    border:2px solid #ffd29f; transition:transform .12s, box-shadow .2s;
  }
  #contact .card:hover{transform:translateY(-3px); box-shadow:0 16px 28px rgba(0,0,0,.16)}
  form label{display:block;font-weight:800;margin:10px 0 6px;color:#7a2c00}
  form input, form textarea{
    width:100%;padding:12px;border-radius:10px;border:2px solid #ffd29f;background:#fff;font-weight:700;
    box-shadow:inset 0 2px 4px rgba(0,0,0,.04); transition:transform .12s, box-shadow .12s;
  }
  form input:hover, form textarea:hover{transform:translateY(-1px)}
  form textarea{min-height:140px;resize:vertical}
  .status{margin-top:10px;font-weight:800}

  /* ---------- Rules Lightbox (missing before = caused the weird bottom blob) ---------- */
  .lightbox{
    position:fixed; inset:0; background:rgba(0,0,0,.7);
    display:none; align-items:center; justify-content:center;
    padding:24px; z-index:3000; cursor:zoom-out;
  }
  .lightbox.open{ display:flex }
  .lightbox img{
    max-width:min(96vw,1200px);
    max-height:92vh; border-radius:12px;
    box-shadow:0 20px 40px rgba(0,0,0,.35);
  }
  .lightbox .controls{
    position:absolute; bottom:20px; display:flex; gap:10px;
  }
  .lightbox .ctrl{
    background:#fff;border:none;border-radius:999px;padding:10px 14px;
    font-weight:900;color:#7a2c00;cursor:pointer;box-shadow:var(--shadow);
  }

  /* ---------- Mobile: center content; hide ONLY hero cards ---------- */
  @media (max-width:700px){
    .hero-collage{display:none !important}
    header{min-height:100svh; display:grid; place-items:center;}
    .hero-inner{padding:0 20px}
  }
</style>
</head>
<body>

<header id="hero">
  <div class="hero-collage" id="heroCollage" aria-hidden="true"></div>

  <div class="hero-inner">
    <div class="hero-kicker">
      <span class="verb-rotate" id="verb">Cook</span> ‚Ä¢ trade ‚Ä¢ out-chef your friends
    </div>
    <div class="title-plate"><h1 class="hero-title">Food&nbsp;Jam</h1></div>

    <div class="pills">
      <span class="pill">2‚Äì5 Players</span>
      <span class="pill">Ages 6+</span>
      <span class="pill">15‚Äì25 Minutes</span>
    </div>

    <div class="cta-row">
      <button class="btn btn-accent" onclick="document.querySelector('#cards').scrollIntoView({behavior:'smooth'})">Explore the Cards</button>
      <button class="btn btn-accent" onclick="document.querySelector('#rules').scrollIntoView({behavior:'smooth'})">Learn the Rules</button>
      <button class="btn btn-accent" onclick="document.querySelector('#contact').scrollIntoView({behavior:'smooth'})">Contact</button>
    </div>

    <!-- desktop-only tweak control -->
  </div>
</header>

<section id="about" class="alt reveal">
  <h2>Game Overview</h2>
  <p class="lead">
    In <b>Food Jam</b>, you race to collect the right ingredients, trade smart, and play spicy action cards to complete recipes for points.
    Two-ingredient recipes score <b>2</b>, three-ingredient recipes score <b>3</b>. Simple‚Ä¶ until someone drops an <i>Oops, Spill</i> or hits you with a <i>Mix-Up</i>.
  </p>
  <div class="how">
    <div class="step">üé≤ Roll to see your moves.</div>
    <div class="step">üõí Draw ingredients or recipes.</div>
    <div class="step">üîÅ Play actions & trade.</div>
    <div class="step">üçΩÔ∏è Cook recipes to score.</div>
  </div>
</section>

<section id="rules" class="reveal">
  <h2>Rules (Quick View)</h2>
  <div>
    <span class="rule-chip">Objective: Most recipe points wins</span>
    <span class="rule-chip">2-ingredient = 2 pts</span>
    <span class="rule-chip">3-ingredient = 3 pts</span>
    <span class="rule-chip">Hand limit: 2 recipes & 5 ingredients</span>
  </div>
  <div class="features" style="margin-top:10px">
    <div class="feature"><b>Setup</b>
      <ol><li>Shuffle each deck separately: Recipe, Actions, Ingredients.</li>
          <li>Place decks face down; make discard piles for Actions & Ingredients.</li>
          <li>Deal each player <b>3 ingredients</b> and <b>1 recipe</b>.</li></ol></div>
    <div class="feature"><b>Gameplay</b>
      <ol><li>Youngest starts.</li>
          <li>Roll: <b>1‚Äì2 = 1</b>, <b>3‚Äì4 = 2</b>, <b>5‚Äì6 = 3</b> moves.</li>
          <li>Moves: draw, discard, trade, or play an action.</li></ol></div>
    <div class="feature"><b>Winning</b>
      <ul><li>When the last recipe is drawn, put the <b>Golden Spoon</b> on it (+1).</li>
          <li>When that recipe is cooked, the game ends. Most points wins.</li></ul></div>
  </div>
  <p style="margin:14px 0 8px;font-weight:800;color:#7a2c00">Tap to zoom the full rule sheets:</p>
  <div class="rules-grid">
    <img data-rule src="Rule2.png" alt="Food Jam Rules 1" />
    <img data-rule src="Rule1.png" alt="Food Jam Rules 2" />
  </div>
</section>

<section id="cards" class="reveal">
  <h2>Card Explorer</h2>
  <p class="lead">Click a card to view. Click the card to flip. Use the side arrows or ‚Üê / ‚Üí to move.</p>

  <div class="toolbar">
    <div class="filters" id="filters"></div>
    <div class="search"><input id="search" type="search" placeholder="Search cards‚Ä¶"></div>
  </div>

  <div class="grid" id="grid" aria-live="polite"></div>
</section>

<!-- FULL-BLEED CONTACT CTA WITH FORM -->
<section class="cta cta-full reveal" id="contact">
  <div class="inner">
    <h2>Interested in trying Food Jam?</h2>
    <div class="card">
      <!-- Formspree: Food Jam / Inquiries -->
      <form id="fjForm" action="https://formspree.io/f/mwpnoonq" method="POST">
        <input type="hidden" name="project" value="Food Jam">
        <input type="hidden" name="form_name" value="Inquiries">
        <input type="hidden" name="_subject" value="Food Jam ‚Äî Inquiries">
        <label for="fjName">Your name</label>
        <input id="fjName" type="text" name="name" required placeholder="Jane Doe" autocomplete="name" />
        <label for="fjEmail">Your email</label>
        <input id="fjEmail" type="email" name="email" required autocomplete="email" placeholder="you@example.com" />
        <label for="fjMsg">Your message</label>
        <textarea id="fjMsg" name="message" required placeholder="How can we help?"></textarea>
        <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <button class="btn btn-accent" type="submit">Send</button>
          <span class="status" id="fjStatus" aria-live="polite"></span>
        </div>
      </form>
    </div>
  </div>
</section>

<!-- MINIMAL VIEWER -->
<div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="Card viewer">
  <div class="viewer-min" id="viewer">
    <button class="edge edge-left" id="prevBtn" aria-label="Previous">‚Äπ</button>
    <div class="card3d" id="card3d">
      <div class="face front"><img id="frontImg" alt=""></div>
      <div class="face back"><img id="backImg" alt=""></div>
    </div>
    <button class="edge edge-right" id="nextBtn" aria-label="Next">‚Ä∫</button>
    <div class="caption" id="caption"></div>
    <button class="btn close" id="close" aria-label="Close">‚úï</button>
  </div>
</div>

<!-- RULES LIGHTBOX -->
<div class="lightbox" id="lightbox">
  <img id="lightboxImg" alt="Rules sheet" />
  <div class="controls">
    <button class="ctrl" id="lbPrev">‚óÄ</button>
    <button class="ctrl" id="lbNext">‚ñ∂</button>
    <button class="ctrl" id="lbClose">Close</button>
  </div>
</div>

<script>
/* ===== Card data ===== */
const BASE = 'Food Jam Ingredient Cards (2)/';
const BACKS = {
  action: BASE + 'Actions Card Back.png',
  recipe: BASE + 'Recipies Back.png',
  ingredient: BASE + 'Ingridiants Back.png'
};
const CARDS = [
  {name:'Apple', type:'Ingredient', front:BASE+'Apple.png'},
  {name:'Banana', type:'Ingredient', front:BASE+'Banana.png'},
  {name:'Bread', type:'Ingredient', front:BASE+'Bread Card.png'},
  {name:'Cheese', type:'Ingredient', front:BASE+'Cheese Card.png'},
  {name:'Cherry', type:'Ingredient', front:BASE+'Cherry.png'},
  {name:'Chocolate', type:'Ingredient', front:BASE+'Chocolate.png'},
  {name:'Ice Cream', type:'Ingredient', front:BASE+'Ice Cream.png'},
  {name:'Lettuce', type:'Ingredient', front:BASE+'Lettuce Card.png'},
  {name:'Magic Berry', type:'Ingredient', front:BASE+'Magic Berry.png', note:'Counts as any ingredient'},
  {name:'Orange', type:'Ingredient', front:BASE+'Orange.png'},
  {name:'Tomato', type:'Ingredient', front:BASE+'Tomato Card.png'},

  {name:'Fruit Basket', type:'Recipe', front:BASE+'Friut Basket (recipie).png'},
  {name:'Fruit Salad', type:'Recipe', front:BASE+'Friut Salad (recipie).png'},
  {name:'Grilled Cheese', type:'Recipe', front:BASE+'Grilled Cheese (recipie).png'},
  {name:'Pizza', type:'Recipe', front:BASE+'Pizza (recipie).png'},
  {name:'Salad', type:'Recipe', front:BASE+'Salad (recipie).png'},
  {name:'Sundae', type:'Recipe', front:BASE+'Sundae (recipie).png'},
  {name:'Veggie Sandwich', type:'Recipe', front:BASE+'Veggie Sandwich (recipie).png'},

  {name:'Big Spoon', type:'Action', front:BASE+'Big Spoon (action).png'},
  {name:'Magic Oven', type:'Action', front:BASE+'Magic Oven (action).png'},
  {name:'Mix-Up', type:'Action', front:BASE+'Mix-Up (action).png'},
  {name:'Oops, Spill', type:'Action', front:BASE+'Oops, Spill (action).png'},
  {name:'Rotten', type:'Action', front:BASE+'Rotten (action).png'},

  {name:'Actions Back', type:'Backs', front:BACKS.action},
  {name:'Ingredients Back', type:'Backs', front:BACKS.ingredient},
  {name:'Recipes Back', type:'Backs', front:BACKS.recipe},
];

/* ===== Faster verb rotation ===== */
(() => {
  const verbs = ['Cook','Flip','Steal','Jam'];
  const el = document.getElementById('verb');
  let i = 0;
  setInterval(()=>{
    i=(i+1)%verbs.length;
    el.classList.remove('swap'); void el.offsetWidth;
    el.textContent = verbs[i];
    el.classList.add('swap');
  }, 1600);
})();

/* ===== Helpers ===== */
function deckBackFor(card){
  const t = (card.type||'').toLowerCase();
  if(t==='action') return BACKS.action;
  if(t==='recipe') return BACKS.recipe;
  if(t==='ingredient') return BACKS.ingredient;
  return card.front;
}

/* ===== HERO COLLAGE: responsive sizing + user scale + min/max velocity ===== */
(() => {
  const stage = document.getElementById('heroCollage');
  const hero  = document.getElementById('hero');
  const MOBILE_BREAK = 700;
  let isMobile = window.matchMedia(`(max-width:${MOBILE_BREAK}px)`).matches;

  // Motion tunables
  const PHYS = {
    LOCAL_R: 190,
    LOCAL_K: 360,
    CENTER_FORCE: 500,
    SWIRL: 14,
    DAMP: 0.992,
    TARGET: 170,
    MIN: 60,
    MAX: 300
  };

  // Size tunables ‚Äî cards scale with viewport (minDim)
  const SIZE = {
    baseFrac: 0.14,
    // ~12% of the smaller viewport dimension
    jitter:   0.40,   // ¬±20% variance per card
    minPx:    90,     // floor
    maxFrac:  0.22    // cap vs viewport
  };

  // User-controlled global scale (via slider), persisted
  let userScale = Number(localStorage.getItem('fjCardScale') || '1');
  const slider = document.getElementById('sizeRange');
  const sizeVal = document.getElementById('sizeVal');
  const updateSliderUI = () => {
    if(!slider) return;
    slider.value = Math.round(userScale * 100);
    if(sizeVal) sizeVal.textContent = `${Math.round(userScale * 100)}%`;
  };
  if(slider){
    updateSliderUI();
    slider.addEventListener('input', e=>{
      userScale = Math.max(0.5, Math.min(2, Number(e.target.value)/100));
      localStorage.setItem('fjCardScale', String(userScale));
      rescaleBodies();
      updateSliderUI();
    });
  }

  // one of each (no backs)
  const fronts = [...new Map(
    CARDS.filter(c=>c.type!=='Backs').map(c => [c.name, {name:c.name,type:c.type,src:c.front}])
  ).values()];

  // Fisher‚ÄìYates
  for (let i = fronts.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [fronts[i], fronts[j]] = [fronts[j], fronts[i]];
  }

  let bodies = [], bounds, center, repelR, sigma;
  const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));

  function inSafe(x,y,w,h){
    const sx=bounds.w*0.34, sy=bounds.h*0.36, sw=bounds.w*0.32, sh=bounds.h*0.30;
    return !(x+w<sx || x>sx+sw || y+h<sy || y>sy+sh);
  }

  function computeSize(mul=1){
    const minDim = Math.min(bounds.w, bounds.h);
    const maxPx  = minDim * SIZE.maxFrac;
    const w      = clamp(minDim * SIZE.baseFrac * mul * userScale, SIZE.minPx, maxPx);
    return { w, h: w * 1.33 };
  }

  function createBody(meta){
    if(!meta || !meta.src) return null;

    const el = document.createElement('div');
    el.className='mini-card';
    el.dataset.cardName=meta.name; el.dataset.cardType=meta.type;

    const mul = 1 - SIZE.jitter/2 + Math.random()*SIZE.jitter;
    const {w,h} = computeSize(mul);

    el.style.width=w+'px'; el.style.height=h+'px';
    el.innerHTML = `<img src="${meta.src}" alt="">`;
    stage.appendChild(el);

    let x,y,tries=0;
    do{ x=Math.random()*(bounds.w-w); y=Math.random()*(bounds.h-h); tries++; }while(inSafe(x,y,w,h)&&tries<400);

    const speed = 70 + Math.random()*40;
    const ang = Math.random()*Math.PI*2;
    const vx = Math.cos(ang)*speed, vy = Math.sin(ang)*speed;

    el.style.setProperty('--x', x+'px'); el.style.setProperty('--y', y+'px');
    return {el,x,y,w,h,vx,vy,name:meta.name,type:meta.type,mul};
  }

  function rescaleBodies(){
    for(const p of bodies){
      const {w,h} = computeSize(p.mul);
      p.w=w; p.h=h;
      p.x = clamp(p.x, 0, Math.max(0, bounds.w - p.w));
      p.y = clamp(p.y, 0, Math.max(0, bounds.h - p.h));
      p.el.style.width = w+'px';
      p.el.style.height = h+'px';
      p.el.style.setProperty('--x', p.x+'px');
      p.el.style.setProperty('--y', p.y+'px');
    }
  }

  function clearStage(){
    bodies.length=0;
    stage.innerHTML='';
    tick.last = undefined;
  }

  function resize(){
    isMobile = window.matchMedia(`(max-width:${MOBILE_BREAK}px)`).matches;
    const r = stage.getBoundingClientRect();
    bounds = {w:r.width,h:r.height};
    center = {x:r.width/2,y:r.height/2};
    repelR = Math.min(r.width,r.height)*0.26;
    sigma  = repelR*0.70;

    if(isMobile){
      clearStage();
      stage.style.display='none';
      return;
    }
    stage.style.display='';
    if(bodies.length===0){
      fronts.forEach(f => { const b = createBody(f); if (b) bodies.push(b); });
    }else{
      rescaleBodies();
    }
  }

  function tick(ts){
    if(isMobile){ requestAnimationFrame(tick); return; }
    if(!tick.last) tick.last=ts;
    const dt = Math.min(0.05,(ts-tick.last)/1000); tick.last=ts;

    const localR=PHYS.LOCAL_R, k=PHYS.LOCAL_K;
    for(let i=0;i<bodies.length;i++){
      const a=bodies[i];
      for(let j=i+1;j<bodies.length;j++){
        const b=bodies[j];
        const dx=(a.x+a.w/2)-(b.x+b.w/2), dy=(a.y+a.h/2)-(b.y+b.h/2);
        const d=Math.hypot(dx,dy);
        if(d>0 && d<localR){
          const f=k*(1-d/localR);
          const ux=dx/d, uy=dy/d;
          a.vx+=ux*f*dt; a.vy+=uy*f*dt;
          b.vx-=ux*f*dt; b.vy-=uy*f*dt;
        }
      }
    }

    for(const p of bodies){
      const cx=(p.x+p.w/2)-center.x, cy=(p.y+p.h/2)-center.y;
      const r2=cx*cx+cy*cy, r=Math.sqrt(r2)+1e-4;
      const repulse=Math.exp(-r2/(2*sigma*sigma));
      const F=PHYS.CENTER_FORCE*repulse;
      p.vx+=(cx/r)*(F*dt); p.vy+=(cy/r)*(F*dt);

      const t=ts*0.00045;
      p.vx+=Math.cos(t+p.y*0.003)*PHYS.SWIRL*dt;
      p.vy+=Math.sin(t+p.x*0.003)*PHYS.SWIRL*dt;

      p.vx*=PHYS.DAMP; p.vy*=PHYS.DAMP;
      let sp=Math.hypot(p.vx,p.vy);

      if(sp<PHYS.MIN){
        const nudge = PHYS.MIN/(sp+1e-6);
        p.vx*=nudge; p.vy*=nudge;
        sp=PHYS.MIN;
      }

      if(sp<PHYS.TARGET){ const scale=1+0.25*dt; p.vx*=scale; p.vy*=scale; sp=Math.hypot(p.vx,p.vy); }

      if(sp>PHYS.MAX){ p.vx=p.vx/sp*PHYS.MAX; p.vy=p.vy/sp*PHYS.MAX; }

      p.x+=p.vx*dt; p.y+=p.vy*dt;
      if(p.x<0){ p.x=0; p.vx=Math.abs(p.vx); }
      if(p.y<0){ p.y=0; p.vy=Math.abs(p.vy); }
      if(p.x+p.w>bounds.w){ p.x=bounds.w-p.w; p.vx=-Math.abs(p.vx); }
      if(p.y+p.h>bounds.h){ p.y=bounds.h-p.h; p.vy=-Math.abs(p.vy); }

      p.el.style.setProperty('--x', p.x+'px');
      p.el.style.setProperty('--y', p.y+'px');
    }
    requestAnimationFrame(tick);
  }

  stage.addEventListener('click', e=>{
    const card=e.target.closest('.mini-card'); if(!card) return;
    const idx=CARDS.findIndex(c=>c.name===card.dataset.cardName);
    if(idx>=0) openViewer(CARDS, idx);
  });

  hero.addEventListener('mousemove', e=>{
    if(isMobile) return;
    const r=hero.getBoundingClientRect();
    const px=(e.clientX-r.left)/r.width-.5, py=(e.clientY-r.top)/r.height-.5;
    stage.style.transition='transform .06s linear';
    stage.style.transform=`translate3d(${px*-18}px, ${py*-12}px, 0)`;
  });
  const easeHome=()=>{ stage.style.transition='transform .45s ease'; stage.style.transform='translate3d(0,0,0)'; };
  hero.addEventListener('mouseleave', easeHome);
  window.addEventListener('mouseout', e=>{ if(!e.relatedTarget) easeHome(); });

  resize();
  window.addEventListener('resize', resize);
  requestAnimationFrame(tick);
})();

/* ===== Reveal on scroll ===== */
(() => {
  const targets = document.querySelectorAll('.reveal');
  targets.forEach(el=>el.classList.add('show'));
  if ('IntersectionObserver' in window) {
    targets.forEach(el=>el.classList.remove('show'));
    const io = new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target); }
      });
    }, {threshold: 0.12});
    targets.forEach(el=>io.observe(el));
  }
})();

/* ===== Rules Lightbox ===== */
(() => {
  const imgs = Array.from(document.querySelectorAll('img[data-rule]'));
  const lb = document.getElementById('lightbox');
  const view = document.getElementById('lightboxImg');
  let idx = 0;
  function open(i){ idx=i; view.src = imgs[idx].src; lb.classList.add('open'); }
  function close(){ lb.classList.remove('open'); }
  function next(){ idx=(idx+1)%imgs.length; view.src=imgs[idx].src; }
  function prev(){ idx=(idx-1+imgs.length)%imgs.length; view.src=imgs[idx].src; }
  imgs.forEach((img,i)=>img.addEventListener('click',()=>open(i)));
  document.getElementById('lbClose').onclick = close;
  document.getElementById('lbNext').onclick = next;
  document.getElementById('lbPrev').onclick = prev;
  lb.addEventListener('click', e=>{ if(e.target===lb) close(); }); // click outside to close
  window.addEventListener('keydown', e=>{
    if(!lb.classList.contains('open')) return;
    if(e.key==='Escape') lb.classList.remove('open');
    if(e.key==='ArrowRight') next();
    if(e.key==='ArrowLeft') prev();
  });
})();

/* ===== Card Explorer ===== */
const TYPES = ['All','Ingredient','Recipe','Action','Backs'];
const grid=document.getElementById('grid'), filters=document.getElementById('filters'), search=document.getElementById('search');
let currentType='All', query='';
function buildFilters(){TYPES.forEach(t=>{const b=document.createElement('button');b.className='chip'+(t===currentType?' active':'');b.textContent=t;b.onclick=()=>{currentType=t;syncFilters();render();};filters.appendChild(b);});}
function syncFilters(){Array.from(filters.children).forEach(ch=>ch.classList.toggle('active', ch.textContent===currentType));}
function matches(c){const ok=(currentType==='All'||c.type===currentType);if(!ok)return false;if(!query)return true;const q=query.toLowerCase();return c.name.toLowerCase().includes(q)||c.type.toLowerCase().includes(q);}
function currentData(){return CARDS.filter(matches);}
function render(){
  grid.innerHTML='';
  const data=currentData();
  data.forEach((c,i)=>{
    const d=document.createElement('div');
    d.className='tile';
    d.dataset.index=i;
    d.dataset.name=c.name;
    d.innerHTML=`<span class="type-tag">${c.type}</span><img src="${c.front}" alt="${c.name}"><div class="label">${c.name}</div>`;
    d.onclick=()=>openViewer(data,i);
    grid.appendChild(d);
  });
}
search.addEventListener('input', e=>{query=e.target.value.trim();render();});
buildFilters(); render();

/* ===== Minimal Viewer ===== */
const modal=document.getElementById('modal'), card3d=document.getElementById('card3d');
const frontImg=document.getElementById('frontImg'), backImg=document.getElementById('backImg'), caption=document.getElementById('caption');
const nextBtn=document.getElementById('nextBtn'), prevBtn=document.getElementById('prevBtn'), closeBtn=document.getElementById('close');
let activeList=[], activeIdx=0;

function setCard(c){
  card3d.classList.remove('flipped');
  frontImg.src = c.front;
  backImg.src  = deckBackFor(c);
  caption.textContent = `${c.name} ‚Ä¢ ${c.type}`;
  card3d.dataset.flippable = (c.type!=='Backs');
}

function openViewer(list, idx){
  activeList = list.slice();
  activeIdx  = idx;
  setCard(activeList[activeIdx]);
  modal.classList.add('open');
}
function show(delta){
  if(!activeList.length) return;
  activeIdx = (activeIdx + delta + activeList.length) % activeList.length;
  setCard(activeList[activeIdx]);
}
function closeViewer(){ modal.classList.remove('open'); }

[nextBtn,prevBtn,closeBtn].forEach(btn=>btn.addEventListener('click', e=>e.stopPropagation()));
nextBtn.addEventListener('click', ()=>show(+1));
prevBtn.addEventListener('click', ()=>show(-1));
closeBtn.addEventListener('click', closeViewer);
card3d.addEventListener('click', ()=>{ if(card3d.dataset.flippable!=='false') card3d.classList.toggle('flipped'); });
modal.addEventListener('click', (e)=>{ if(e.target===modal) closeViewer(); });
window.addEventListener('keydown', e=>{
  if(!modal.classList.contains('open')) return;
  if(e.key==='Escape') closeViewer();
  if(e.key==='ArrowRight') show(+1);
  if(e.key==='ArrowLeft')  show(-1);
  if(e.key.toLowerCase()==='f' && card3d.dataset.flippable!=='false') card3d.classList.toggle('flipped');
});

/* ===== Formspree AJAX submit ===== */
(() => {
  const form = document.getElementById('fjForm');
  const status = document.getElementById('fjStatus');
  if(!form) return;
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    status.textContent = 'Sending‚Ä¶';
    const data = new FormData(form);
    try{
      const res = await fetch(form.action, {
        method: 'POST',
        body: data,
        headers: { 'Accept': 'application/json' }
      });
      if(res.ok){
        status.textContent = 'Thanks! We‚Äôll reply soon.';
        form.reset();
      }else{
        const j = await res.json().catch(()=>({}));
        status.textContent = j.errors?.map(x=>x.message).join(', ') || 'Something went wrong. Try again?';
      }
    }catch(err){
      status.textContent = 'Network error. Please try again.';
    }
  });
})();
</script>
</body>
</html>
